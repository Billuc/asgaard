import"../chunks/DsnmJJEf.js";import{i as ke}from"../chunks/B2RB5TeL.js";import{j as V,p as B,f as k,s as C,d as F,r as D,b as v,c as I,i as M,t as _,e as R,aT as me,aU as Ce,a as N,k as Z,m as Q,g as W,n as Fe,l as be,h as ye,$ as we}from"../chunks/CdW2wo26.js";import{a as Y}from"../chunks/DvLb1K2C.js";import{B as pe}from"../chunks/BlfYTLpw.js";import{p as Ee}from"../chunks/CENNA1TF.js";import{m as ie,s as se,r as _e,b as Ae,u as xe,d as Le,A as Se,a as $e}from"../chunks/rM3fkrv5.js";import{e as q,r as z,a as Be,d as X,g as ae}from"../chunks/CQoQAeYi.js";import{t as U,a as fe}from"../chunks/BOSBZZph.js";import{f as ge,Q as Me}from"../chunks/BIYFnzYS.js";import{f as Te,s as J}from"../chunks/DuQvw7Am.js";import{i as G}from"../chunks/Bbijo58t.js";import{p as ee,b as le}from"../chunks/86hmsk0G.js";import{g as De}from"../chunks/BfecHv-i.js";import{o as Ie}from"../chunks/Nbjk0067.js";import{g as Ne}from"../chunks/wW2WasLs.js";import"../chunks/CiNeUwox.js";import{c as He}from"../chunks/BwYyNQVj.js";var w=(r=>(r.LIST="list",r.NOTE="note",r.QUEST="quest",r))(w||{});const Oe={list:"List",note:"Note",quest:"Quest"};var Pe=(r,c,m)=>c.createItem(m()),Ge=k("<li><button> </button></li>"),Re=k('<div class="dropdown dropdown-center dropdown-bottom"><div tabindex="0" role="button" class="btn btn-outline btn-sm btn-info">New Item</div> <ul tabindex="0" class="dropdown-content menu z-1 w-52 rounded-box bg-base-100 p-2 shadow-sm"></ul></div>');function qe(r,c){B(c,!0);var m=Re(),e=C(F(m),2);q(e,21,()=>Object.entries(Oe),([i,t])=>i,(i,t)=>{var n=me(()=>Ce(M(t),2));let s=()=>M(n)[0],a=()=>M(n)[1];var o=Ge(),u=F(o);u.__click=[Pe,c,s];var h=F(u);D(u),D(o),_(()=>R(h,`New ${a()??""}`)),v(i,o)}),D(e),D(m),v(r,m),I()}V(["click"]);var ze=(r,c,m)=>c()({...m.data,title:r.target.value}),Ue=(r,c,m)=>c(m.data.list.filter(e=>!e.done)),Ve=(r,c,m)=>c()({...m.data,hideDone:!m.data.hideDone}),je=k('<div class="flex flex-row gap-1"><button class="btn inline btn-xs">Up</button> <button class="btn inline btn-xs">Down</button> <button class="btn btn-xs btn-error">Delete</button></div>'),Ke=k('<div class="flex flex-row items-center gap-2 px-1"><input type="checkbox" class="checkbox checkbox-primary"/> <input class="input input-sm grow input-ghost"/> <!></div>'),Ze=(r,c,m,e)=>c([...m.data.list,{done:!1,label:M(e),id:De("item")}]),Qe=k('<div class="card-title"><input class="input input-sm grow input-ghost text-lg font-bold"/> <button class="btn btn-sm">Clear completed</button> <button class="btn btn-sm"> </button></div> <div class="flex w-full flex-col"></div> <label class="input input-sm w-full rounded-md px-1"><button class="btn btn-square font-bold btn-xs btn-info">+</button> <input type="text" class="grow" placeholder="New item"/></label>',1);function We(r,c){B(c,!0);let m=ee(c,"updateData",3,()=>{}),e=Z(""),i=me(()=>c.data.list.filter(g=>!g.done||!c.data.hideDone));function t(g){m()({...c.data,list:g})}var n=Qe(),s=N(n),a=F(s);z(a),a.__change=[ze,m,c];var o=C(a,2);o.__click=[Ue,t,c];var u=C(o,2);u.__click=[Ve,m,c];var h=F(u,!0);D(u),D(s);var d=C(s,2);q(d,31,()=>M(i),g=>g.id,(g,p,b)=>{var A=Ke(),x=F(A);z(x),x.__change=()=>t(ie(c.data.list,M(b),S=>({...S,done:!S.done})));var L=C(x,2);z(L),L.__input=S=>t(ie(c.data.list,M(b),O=>({...O,label:S.target.value})));var y=C(L,2);{var H=S=>{var O=je(),te=F(O);te.__click=()=>t(se(c.data.list,M(b),M(b)-1));var ne=C(te,2);ne.__click=()=>t(se(c.data.list,M(b),M(b)+1));var ve=C(ne,2);ve.__click=()=>t(_e(c.data.list,M(b))),D(O),U(3,O,()=>J,()=>({axis:"x"})),v(S,O)};G(y,S=>{c.showActions&&S(H)})}D(A),_(()=>{Be(x,M(p).done),X(L,M(p).label)}),U(3,A,()=>Te),fe(A,()=>ge,()=>({duration:300})),v(g,A)}),D(d);var l=C(d,2),T=F(l);T.__click=[Ze,t,c,e];var f=C(T,2);z(f),D(l),_(()=>{X(a,c.data.title),R(h,c.data.hideDone?"Show done":"Hide done")}),Ae(f,()=>M(e),g=>Q(e,g)),v(r,n),I()}V(["change","click","input"]);var E={},$={},j={},re;function Xe(){if(re)return j;re=1,Object.defineProperty(j,"__esModule",{value:!0});const r={blockquote:'<svg height="18" width="18"><rect width="5" height="5" x="3" y="4" ry="1"/><rect ry="1" y="4" x="10" height="5" width="5"/><path d="M8 6.999v3c0 1-1 3-1 3s-.331 1-1.331 1h-1c-1 0-.669-1-.669-1s1-2 1-3v-3zm7 0v3c0 1-1 3-1 3s-.331 1-1.331 1h-1c-1 0-.669-1-.669-1s1-2 1-3v-3z"/></svg>',bold:'<svg height="18" width="18"><path d="M4 2a1 1 0 00-1 1v12a1 1 0 001 1h6c4 0 5-2 5-4 0-1.322-.434-2.636-1.885-3.381C13.772 7.885 14 6.945 14 6c0-2-1-4-5-4zm1 2h4c1.668 0 2.32.393 2.6.672.28.279.4.662.4 1.328s-.12 1.057-.4 1.338c-.275.274-1.014.646-2.6.662H5zm5 6c1.666.005 2.318.388 2.596.666.277.278.404.667.404 1.334s-.127 1.06-.404 1.338c-.278.278-.93.66-2.596.662l-4.992.004L5 10z"/></svg>',clear_formatting:'<svg height="18" width="18"><path d="M11.03 1a1 1 0 00-.74.3l-9 9a1 1 0 000 1.4l4 4A1 1 0 006 16h2a1 1 0 00.7-.3l8-8a1 1 0 000-1.4l-5-5a1 1 0 00-.67-.3zM8.7 5.7l3.58 3.6L7.6 14H6.4l-3-3 5.3-5.3z"/><rect ry=".8" rx=".8" y="14" x="16" height="2" width="2"/><rect width="2" height="2" x="13" y="14" rx=".8" ry=".8"/><rect ry=".8" rx=".8" y="14" x="10" height="2" width="2"/></svg>',code:'<svg height="18" width="18"><path d="M13.5 2.994a.5.5 0 00-.5.5.5.5 0 000 .034V4.53a5.993 5.993 0 00-7.451-.445A6 6 0 1012.45 13.9a5.99 5.99 0 001.346-1.334.5.5 0 00.096-.101.5.5 0 00-.12-.698.5.5 0 00-.697.12l-.004-.005a5 5 0 01-1.197 1.2 5 5 0 111.215-6.965.5.5 0 00.697.12.5.5 0 00.211-.44V4.745H14V3.493a.5.5 0 00-.5-.5z"/></svg>',h1:'<svg height="18" width="18"><path d="M3 2s0-1 1-1h1c1 0 1 1 1 1v6h6V2s0-1 1-1h1c1 0 1 1 1 1v14s0 1-1 1h-1c-1 0-1-1-1-1v-6H6v6s0 1-1 1H4c-1 0-1-1-1-1z"/></svg>',h2:'<svg height="18" width="18"><path d="M4 2s0-1 1-1 1 1 1 1v6c1-1 2-1 4-1 3 0 4 2 4 4v5s0 1-1 1-1-1-1-1v-5c0-1.094-1-2-2-2-2 0-3 0-4 2v5s0 1-1 1-1-1-1-1z"/></svg>',hr:'<svg height="18" width="18"><rect ry="1" y="8" height="2" width="18" style="font-variation-settings:normal;marker:none"/></svg>',image:'<svg height="18" width="18"><path d="M1 2v14h16V2H1zm2 2h12v7l-3-3-4 4-2-2-3 3V4z"/><circle r="1.5" cy="6.5" cx="5.5"/></svg>',italic:'<svg height="18" width="18"><path d="M9 2a1 1 0 000 2L7 14a1 1 0 100 2h2a1 1 0 000-2l2-10a1 1 0 100-2z"/></svg>',link:'<svg height="18" width="18"><path d="M9.07 5.18a3.9 3.9 0 00-1.52.43C6.31 6.22 5.3 7.29 4.3 8.29c-1 1-2.07 2.02-2.68 3.26-.31.62-.5 1.33-.41 2.07.09.75.48 1.47 1.1 2.09.61.61 1.33 1 2.08 1.1.74.09 1.45-.1 2.07-.42 1.24-.61 2.26-1.68 3.26-2.68.46-.47.94-.94 1.39-1.44l-.43.26c-.68.34-1.49.56-2.36.46-.2-.03-.4-.08-.6-.14-.79.76-1.55 1.45-2.16 1.76-.38.19-.67.24-.92.21-.26-.03-.54-.14-.92-.53-.39-.38-.5-.66-.53-.91-.03-.26.02-.55.21-.93.39-.76 1.32-1.74 2.32-2.74 1-1 1.98-1.93 2.74-2.32.38-.19.67-.24.93-.21.25.03.53.14.91.53.39.38.5.66.53.92v.06l1.12-1.06.44-.47c-.18-.3-.4-.6-.67-.87-.62-.61-1.34-1-2.09-1.1a3.08 3.08 0 00-.55-.01z"/><path d="M13.07.86a3.9 3.9 0 00-1.52.43c-1.24.62-2.26 1.69-3.26 2.69-.46.47-.94.94-1.39 1.43.15-.08.28-.18.43-.25a4.4 4.4 0 012.36-.46c.2.02.4.07.6.14.79-.77 1.55-1.46 2.16-1.76.38-.19.67-.25.93-.21.25.03.53.14.91.52.39.38.5.66.53.92.03.26-.02.55-.21.93-.39.76-1.32 1.74-2.32 2.74-1 1-1.98 1.93-2.74 2.31-.38.2-.67.25-.93.22-.25-.04-.53-.15-.91-.53-.39-.38-.5-.66-.53-.92V9c-.36.33-.73.67-1.12 1.06l-.43.46c.17.3.4.6.66.87.62.62 1.34 1 2.08 1.1.75.1 1.46-.1 2.08-.41 1.24-.62 2.26-1.69 3.26-2.69s2.07-2.02 2.68-3.26c.31-.62.5-1.32.41-2.07a3.63 3.63 0 00-1.1-2.08c-.61-.62-1.33-1-2.07-1.1a3.08 3.08 0 00-.56-.02z"/></svg>',ol:'<svg height="18" width="18"><path d="M1.5 7a.5.5 0 100 1h1a.5.5 0 01.5.5c0 .164-.08.31-.14.355l-1.655 1.25A.492.492 0 001 10.5a.5.5 0 00.5.5h2a.5.5 0 000-1H3l.398-.299A1.5 1.5 0 002.5 7z"/><path d="M1.5 12c-.667 0-.667 1 0 1h1.25c.333 0 .333.5 0 .5H2.5c-.667 0-.667 1 0 1h.25c.333 0 .333.5 0 .5H1.5c-.667 0-.667 1 0 1h1c.398 0 .78-.131 1.06-.365.282-.235.44-.554.44-.885a1.121 1.121 0 00-.303-.75c.191-.204.3-.47.303-.75 0-.332-.158-.651-.44-.885-.3-.241-.675-.37-1.06-.365z"/><rect y="13" x="6" height="2" width="12" ry="1"/><rect ry="1" width="12" height="2" x="6" y="8"/><rect y="3" x="6" height="2" width="12" ry="1"/><path d="M1.5 2a.5.5 0 100 1H2v2h-.5a.5.5 0 100 1h2a.5.5 0 100-1H3V2.5c0-.277-.223-.5-.5-.5z"/></svg>',redo:'<svg height="18" width="18"><path d="M 7.2695308,2.7050781 C 8.1128755,2.7081581 8.9529895,2.8712156 9.730469,3.1347656 11.408874,3.7037121 12.90142,4.6847104 14,5.6367188 V 4 h 2 V 9 H 11 V 7 h 1.509765 C 11.59075,6.2485173 10.340208,5.453808 9.0878904,5.0292969 7.4309398,4.4676231 5.9453458,4.468717 4.7070308,5.7070312 c -1.225014,1.2250142 -1.409769,2.7206953 -0.779297,4.2968748 0.630472,1.57618 2.167475,3.158006 4.4433598,4.06836 l -0.7421878,1.855468 c -2.724115,-1.089646 -4.687112,-3.00782 -5.55664,-5.18164 -0.869528,-2.1738206 -0.554283,-4.6781393 1.220703,-6.4531252 0.923857,-0.9238568 2.015388,-1.388828 3.134765,-1.5351563 0.279845,-0.036582 0.560682,-0.053761 0.841797,-0.052734 z" /></svg>',strikethrough:'<svg width="18" height="18"><path d="M10 2C6 2 4 4 4 6c0 .338.08.672.193 1h2.34C6.113 6.629 6 6.295 6 6c0-.334.117-.725.691-1.154C7.265 4.416 8.331 4 10 4h3a1 1 0 000-2zm1.477 9c.413.368.523.706.523 1 0 .334-.127.712-.701 1.143-.575.43-1.632.85-3.299.857l-1.006.007V14H5a1 1 0 000 2h3c4 0 6-2 6-4 0-.338-.081-.672-.195-1z"/><rect ry="1" y="8" x="1" height="2" width="16"/></svg>',ul:'<svg height="18" width="18"><circle cx="2" cy="9" r="2"/><circle cy="4" cx="2" r="2"/><rect y="3" x="6" height="2" width="12" ry="1"/><circle cx="2" cy="14" r="2"/><rect ry="1" width="12" height="2" x="6" y="8"/><rect y="13" x="6" height="2" width="12" ry="1"/></svg>',undo:`<svg height="18" width="18"><path d="M 10.730469 2.7050781 C 9.8871243 2.7081594 9.0470103 2.8712156 8.2695312 3.1347656 C 6.5911256 3.7037121 5.0985797 4.6847104 4 5.6367188 L 4 4 L 2 4 L 2 9 L 7 9 L 7 7 L 5.4902344 7 C 6.4092499 6.2485173 7.6597914 5.453808 8.9121094 5.0292969 C 10.56906 4.4676231 12.054654 4.468717 13.292969 5.7070312 C 14.517983 6.9320454 14.702738 8.4277265 14.072266 10.003906 C 13.441794 11.580086 11.904791 13.161912 9.6289062 14.072266 L 10.371094 15.927734 C 13.095209 14.838088 15.058206 12.919914 15.927734 10.746094 C 16.797262 8.5722734 16.482017 6.0679547 14.707031 4.2929688 C 13.783174 3.369112 12.691643 2.9041408 11.572266 2.7578125 C 11.292421 2.7212304 11.011584 2.704051 10.730469 2.7050781 z " /></svg>
`};return j.default=r,j}var oe;function Ye(){if(oe)return $;oe=1;var r=$&&$.__importDefault||function(t){return t&&t.__esModule?t:{default:t}};Object.defineProperty($,"__esModule",{value:!0}),$.CommandBar=void 0;const c=r(Xe()),m=/(Mac|iPhone|iPod|iPad)/i.test(typeof navigator<"u"?navigator.platform:""),e={bold:{name:"bold",action:"bold",innerHTML:c.default.bold,title:"Bold",hotkey:"Mod-B"},italic:{name:"italic",action:"italic",innerHTML:c.default.italic,title:"Italic",hotkey:"Mod-I"},strikethrough:{name:"strikethrough",action:"strikethrough",innerHTML:c.default.strikethrough,title:"Strikethrough",hotkey:"Mod2-Shift-5"},code:{name:"code",action:"code",innerHTML:c.default.code,title:"Format as code"},h1:{name:"h1",action:"h1",innerHTML:c.default.h1,title:"Level 1 heading",hotkey:"Mod-Shift-1"},h2:{name:"h2",action:"h2",innerHTML:c.default.h2,title:"Level 2 heading",hotkey:"Mod-Shift-2"},ul:{name:"ul",action:"ul",innerHTML:c.default.ul,title:"Bulleted list"},ol:{name:"ol",action:"ol",innerHTML:c.default.ol,title:"Numbered list"},blockquote:{name:"blockquote",action:"blockquote",innerHTML:c.default.blockquote,title:"Quote",hotkey:"Mod2-Shift-Q"},insertLink:{name:"insertLink",action:t=>{t.isInlineFormattingAllowed()&&t.wrapSelection("[","]()")},enabled:(t,n,s)=>t.isInlineFormattingAllowed(n,s)?!1:null,innerHTML:c.default.link,title:"Insert link",hotkey:"Mod-K"},insertImage:{name:"insertImage",action:t=>{t.isInlineFormattingAllowed()&&t.wrapSelection("![","]()")},enabled:(t,n,s)=>t.isInlineFormattingAllowed(n,s)?!1:null,innerHTML:c.default.image,title:"Insert image",hotkey:"Mod2-Shift-I"},hr:{name:"hr",action:t=>t.paste(`
***
`),enabled:()=>!1,innerHTML:c.default.hr,title:"Insert horizontal line",hotkey:"Mod2-Shift-L"},undo:{name:"undo",action:t=>t.undo(),enabled:t=>t.canUndo?!1:null,innerHTML:c.default.undo,title:"Undo"},redo:{name:"redo",action:t=>t.redo(),enabled:t=>t.canRedo?!1:null,innerHTML:c.default.redo,title:"Redo"}};class i{constructor(n){this.e=null,this.editor=null,this.commands={},this.buttons={},this.state={},this.hotkeys=[],this.e=null,this.editor=null,this.commands={},this.buttons={},this.state={},this.hotkeys=[];let s=null;typeof n.element=="string"?s=document.getElementById(n.element):n.element&&(s=n.element),s||(s=document.body),this.createCommandBarElement(s,n.commands||["bold","italic","strikethrough","|","code","|","h1","h2","|","ul","ol","|","blockquote","hr","|","undo","redo","|","insertLink","insertImage"]),document.addEventListener("keydown",a=>this.handleKeydown(a)),n.editor&&this.setEditor(n.editor)}createCommandBarElement(n,s){this.e=document.createElement("div"),this.e.className="TMCommandBar";for(let a of s)if(a==="|"){let o=document.createElement("div");o.className="TMCommandDivider",this.e.appendChild(o)}else{let o;if(typeof a=="string")if(e[a])o=a,this.commands[o]=e[o];else continue;else if(typeof a=="object"&&a.name)o=a.name,this.commands[o]={},e[o]&&Object.assign(this.commands[o],e[o]),Object.assign(this.commands[o],a);else continue;let u=this.commands[o].title||o;if(this.commands[o].hotkey){const h=this.commands[o].hotkey.split("-");let d=[],l=[];for(let f=0;f<h.length-1;f++)switch(h[f]){case"Ctrl":d.push("ctrlKey"),l.push("Ctrl");break;case"Cmd":d.push("metaKey"),l.push("⌘");break;case"Alt":d.push("altKey"),l.push("Alt");break;case"Option":d.push("altKey"),l.push("⌥");break;case"Win":d.push("metaKey"),l.push("⊞ Win");break;case"Shift":d.push("shiftKey"),l.push("⇧");break;case"Mod":m?(d.push("metaKey"),l.push("⌘")):(d.push("ctrlKey"),l.push("Ctrl"));break;case"Mod2":d.push("altKey"),m?l.push("⌥"):l.push("Alt");break}l.push(h[h.length-1]);let T={modifiers:d,command:o};h[h.length-1].match(/^[0-9]$/)?T.code=`Digit${h[h.length-1]}`:T.key=h[h.length-1].toLowerCase(),this.hotkeys.push(T),u=u.concat(` (${l.join("+")})`)}this.buttons[o]=document.createElement("div"),this.buttons[o].className="TMCommandButton TMCommandButton_Disabled",this.buttons[o].title=u,this.buttons[o].innerHTML=this.commands[o].innerHTML,this.buttons[o].addEventListener("mousedown",h=>this.handleClick(o,h)),this.e.appendChild(this.buttons[o])}n.appendChild(this.e)}handleClick(n,s){this.editor&&(s.preventDefault(),typeof this.commands[n].action=="string"?this.state[n]===!1?this.editor.setCommandState(n,!0):this.editor.setCommandState(n,!1):typeof this.commands[n].action=="function"&&this.commands[n].action(this.editor))}setEditor(n){this.editor=n,n.addEventListener("selection",s=>this.handleSelection(s))}handleSelection(n){if(n.commandState)for(let s in this.commands)n.commandState[s]===void 0?this.commands[s].enabled?this.state[s]=this.commands[s].enabled(this.editor,n.focus,n.anchor):this.state[s]=n.focus?!1:null:this.state[s]=n.commandState[s],this.state[s]===!0?this.buttons[s].className="TMCommandButton TMCommandButton_Active":this.state[s]===!1?this.buttons[s].className="TMCommandButton TMCommandButton_Inactive":this.buttons[s].className="TMCommandButton TMCommandButton_Disabled"}handleKeydown(n){e:for(let s of this.hotkeys)if(s.key&&n.key.toLowerCase()===s.key||s.code&&n.code===s.code){for(let a of s.modifiers)if(!n[a])continue e;this.handleClick(s.command,n);return}}}return $.CommandBar=i,$.default=i,$}var P={},K={},ue;function Je(){return ue||(ue=1,function(r){Object.defineProperty(r,"__esModule",{value:!0}),r.commands=r.inlineGrammar=r.htmlBlockGrammar=r.lineGrammar=r.punctuationTrailing=r.punctuationLeading=void 0,r.createMergedInlineGrammar=i,r.htmlescape=t;const c={ASCIIPunctuation:/[!"#$%&'()*+,\-./:;<=>?@[\]^_`{|}~\\]/,NotTriggerChar:/[^`_*[\]()<>!~]/,Scheme:/[A-Za-z][A-Za-z0-9+.-]{1,31}/,Email:/[a-zA-Z0-9.!#$%&'*+/=?^_`{|}~-]+@[a-zA-Z0-9](?:[a-zA-Z0-9-]{0,61}[a-zA-Z0-9])?(?:\.[a-zA-Z0-9](?:[a-zA-Z0-9-]{0,61}[a-zA-Z0-9])?)*/,HTMLOpenTag:/<HTMLTagName(?:HTMLAttribute)*\s*\/?>/,HTMLCloseTag:/<\/HTMLTagName\s*>/,HTMLTagName:/[A-Za-z][A-Za-z0-9-]*/,HTMLComment:/<!--(?:[^>-]|(?:[^>-](?:[^-]|-[^-])*[^-]))-->/,HTMLPI:/<\?(?:|.|(?:[^?]|\?[^>])*)\?>/,HTMLDeclaration:/<![A-Z]+\s[^>]*>/,HTMLCDATA:/<!\[CDATA\[.*?\]\]>/,HTMLAttribute:/\s+[A-Za-z_:][A-Za-z0-9_.:-]*(?:HTMLAttValue)?/,HTMLAttValue:/\s*=\s*(?:(?:'[^']*')|(?:"[^"]*")|(?:[^\s"'=<>`]+))/,KnownTag:/address|article|aside|base|basefont|blockquote|body|caption|center|col|colgroup|dd|details|dialog|dir|div|dl|dt|fieldset|figcaption|figure|footer|form|frame|frameset|h1|h2|h3|h4|h5|h6|head|header|hr|html|iframe|legend|li|link|main|menu|menuitem|nav|noframes|ol|optgroup|option|p|param|section|source|summary|table|tbody|td|tfoot|th|thead|title|tr|track|ul/};r.punctuationLeading=new RegExp(/^(?:[!"#$%&'()*+,\-./:;<=>?@[\]\\^_`{|}~\xA1\xA7\xAB\xB6\xB7\xBB\xBF\u037E\u0387\u055A-\u055F\u0589\u058A\u05BE\u05C0\u05C3\u05C6\u05F3\u05F4\u0609\u060A\u060C\u060D\u061B\u061E\u061F\u066A-\u066D\u06D4\u0700-\u070D\u07F7-\u07F9\u0830-\u083E\u085E\u0964\u0965\u0970\u0AF0\u0DF4\u0E4F\u0E5A\u0E5B\u0F04-\u0F12\u0F14\u0F3A-\u0F3D\u0F85\u0FD0-\u0FD4\u0FD9\u0FDA\u104A-\u104F\u10FB\u1360-\u1368\u1400\u166D\u166E\u169B\u169C\u16EB-\u16ED\u1735\u1736\u17D4-\u17D6\u17D8-\u17DA\u1800-\u180A\u1944\u1945\u1A1E\u1A1F\u1AA0-\u1AA6\u1AA8-\u1AAD\u1B5A-\u1B60\u1BFC-\u1BFF\u1C3B-\u1C3F\u1C7E\u1C7F\u1CC0-\u1CC7\u1CD3\u2010-\u2027\u2030-\u2043\u2045-\u2051\u2053-\u205E\u207D\u207E\u208D\u208E\u2308-\u230B\u2329\u232A\u2768-\u2775\u27C5\u27C6\u27E6-\u27EF\u2983-\u2998\u29D8-\u29DB\u29FC\u29FD\u2CF9-\u2CFC\u2CFE\u2CFF\u2D70\u2E00-\u2E2E\u2E30-\u2E42\u3001-\u3003\u3008-\u3011\u3014-\u301F\u3030\u303D\u30A0\u30FB\uA4FE\uA4FF\uA60D-\uA60F\uA673\uA67E\uA6F2-\uA6F7\uA874-\uA877\uA8CE\uA8CF\uA8F8-\uA8FA\uA8FC\uA92E\uA92F\uA95F\uA9C1-\uA9CD\uA9DE\uA9DF\uAA5C-\uAA5F\uAADE\uAADF\uAAF0\uAAF1\uABEB\uFD3E\uFD3F\uFE10-\uFE19\uFE30-\uFE52\uFE54-\uFE61\uFE63\uFE68\uFE6A\uFE6B\uFF01-\uFF03\uFF05-\uFF0A\uFF0C-\uFF0F\uFF1A\uFF1B\uFF1F\uFF20\uFF3B-\uFF3D\uFF3F\uFF5B\uFF5D\uFF5F-\uFF65]|\uD800[\uDD00-\uDD02\uDF9F\uDFD0]|\uD801\uDD6F|\uD802[\uDC57\uDD1F\uDD3F\uDE50-\uDE58\uDE7F\uDEF0-\uDEF6\uDF39-\uDF3F\uDF99-\uDF9C]|\uD804[\uDC47-\uDC4D\uDCBB\uDCBC\uDCBE-\uDCC1\uDD40-\uDD43\uDD74\uDD75\uDDC5-\uDDC9\uDDCD\uDDDB\uDDDD-\uDDDF\uDE38-\uDE3D\uDEA9]|\uD805[\uDCC6\uDDC1-\uDDD7\uDE41-\uDE43\uDF3C-\uDF3E]|\uD809[\uDC70-\uDC74]|\uD81A[\uDE6E\uDE6F\uDEF5\uDF37-\uDF3B\uDF44]|\uD82F\uDC9F|\uD836[\uDE87-\uDE8B])/),r.punctuationTrailing=new RegExp(/(?:[!"#$%&'()*+,\-./:;<=>?@[\]\\^_`{|}~\xA1\xA7\xAB\xB6\xB7\xBB\xBF\u037E\u0387\u055A-\u055F\u0589\u058A\u05BE\u05C0\u05C3\u05C6\u05F3\u05F4\u0609\u060A\u060C\u060D\u061B\u061E\u061F\u066A-\u066D\u06D4\u0700-\u070D\u07F7-\u07F9\u0830-\u083E\u085E\u0964\u0965\u0970\u0AF0\u0DF4\u0E4F\u0E5A\u0E5B\u0F04-\u0F12\u0F14\u0F3A-\u0F3D\u0F85\u0FD0-\u0FD4\u0FD9\u0FDA\u104A-\u104F\u10FB\u1360-\u1368\u1400\u166D\u166E\u169B\u169C\u16EB-\u16ED\u1735\u1736\u17D4-\u17D6\u17D8-\u17DA\u1800-\u180A\u1944\u1945\u1A1E\u1A1F\u1AA0-\u1AA6\u1AA8-\u1AAD\u1B5A-\u1B60\u1BFC-\u1BFF\u1C3B-\u1C3F\u1C7E\u1C7F\u1CC0-\u1CC7\u1CD3\u2010-\u2027\u2030-\u2043\u2045-\u2051\u2053-\u205E\u207D\u207E\u208D\u208E\u2308-\u230B\u2329\u232A\u2768-\u2775\u27C5\u27C6\u27E6-\u27EF\u2983-\u2998\u29D8-\u29DB\u29FC\u29FD\u2CF9-\u2CFC\u2CFE\u2CFF\u2D70\u2E00-\u2E2E\u2E30-\u2E42\u3001-\u3003\u3008-\u3011\u3014-\u301F\u3030\u303D\u30A0\u30FB\uA4FE\uA4FF\uA60D-\uA60F\uA673\uA67E\uA6F2-\uA6F7\uA874-\uA877\uA8CE\uA8CF\uA8F8-\uA8FA\uA8FC\uA92E\uA92F\uA95F\uA9C1-\uA9CD\uA9DE\uA9DF\uAA5C-\uAA5F\uAADE\uAADF\uAAF0\uAAF1\uABEB\uFD3E\uFD3F\uFE10-\uFE19\uFE30-\uFE52\uFE54-\uFE61\uFE63\uFE68\uFE6A\uFE6B\uFF01-\uFF03\uFF05-\uFF0A\uFF0C-\uFF0F\uFF1A\uFF1B\uFF1F\uFF20\uFF3B-\uFF3D\uFF3F\uFF5B\uFF5D\uFF5F-\uFF65]|\uD800[\uDD00-\uDD02\uDF9F\uDFD0]|\uD801\uDD6F|\uD802[\uDC57\uDD1F\uDD3F\uDE50-\uDE58\uDE7F\uDEF0-\uDEF6\uDF39-\uDF3F\uDF99-\uDF9C]|\uD804[\uDC47-\uDC4D\uDCBB\uDCBC\uDCBE-\uDCC1\uDD40-\uDD43\uDD74\uDD75\uDDC5-\uDDC9\uDDCD\uDDDB\uDDDD-\uDDDF\uDE38-\uDE3D\uDEA9]|\uD805[\uDCC6\uDDC1-\uDDD7\uDE41-\uDE43\uDF3C-\uDF3E]|\uD809[\uDC70-\uDC74]|\uD81A[\uDE6E\uDE6F\uDEF5\uDF37-\uDF3B\uDF44]|\uD82F\uDC9F|\uD836[\uDE87-\uDE8B])$/),r.lineGrammar={TMH1:{regexp:/^( {0,3}#\s)(.*?)((?:\s+#+\s*)?)$/,replacement:'<span class="TMMark TMMark_TMH1">$1</span>$$2<span class="TMMark TMMark_TMH1">$3</span>'},TMH2:{regexp:/^( {0,3}##\s)(.*?)((?:\s+#+\s*)?)$/,replacement:'<span class="TMMark TMMark_TMH2">$1</span>$$2<span class="TMMark TMMark_TMH2">$3</span>'},TMH3:{regexp:/^( {0,3}###\s)(.*?)((?:\s+#+\s*)?)$/,replacement:'<span class="TMMark TMMark_TMH3">$1</span>$$2<span class="TMMark TMMark_TMH3">$3</span>'},TMH4:{regexp:/^( {0,3}####\s)(.*?)((?:\s+#+\s*)?)$/,replacement:'<span class="TMMark TMMark_TMH4">$1</span>$$2<span class="TMMark TMMark_TMH4">$3</span>'},TMH5:{regexp:/^( {0,3}#####\s)(.*?)((?:\s+#+\s*)?)$/,replacement:'<span class="TMMark TMMark_TMH5">$1</span>$$2<span class="TMMark TMMark_TMH5">$3</span>'},TMH6:{regexp:/^( {0,3}######\s)(.*?)((?:\s+#+\s*)?)$/,replacement:'<span class="TMMark TMMark_TMH6">$1</span>$$2<span class="TMMark TMMark_TMH6">$3</span>'},TMBlockquote:{regexp:/^( {0,3}>[ ]?)(.*)$/,replacement:'<span class="TMMark TMMark_TMBlockquote">$1</span>$$2'},TMCodeFenceBacktickOpen:{regexp:/^( {0,3}(?<seq>````*)\s*)([^`]*?)(\s*)$/,replacement:'<span class="TMMark TMMark_TMCodeFenceBacktick">$1</span><span class="TMInfoString">$3</span>$4'},TMCodeFenceTildeOpen:{regexp:/^( {0,3}(?<seq>~~~~*)\s*)(.*?)(\s*)$/,replacement:'<span class="TMMark TMMark_TMCodeFenceTilde">$1</span><span class="TMInfoString">$3</span>$4'},TMCodeFenceBacktickClose:{regexp:/^( {0,3}(?<seq>````*))(\s*)$/,replacement:'<span class="TMMark TMMark_TMCodeFenceBacktick">$1</span>$3'},TMCodeFenceTildeClose:{regexp:/^( {0,3}(?<seq>~~~~*))(\s*)$/,replacement:'<span class="TMMark TMMark_TMCodeFenceTilde">$1</span>$3'},TMBlankLine:{regexp:/^([ \t]*)$/,replacement:"$0"},TMSetextH1Marker:{regexp:/^ {0,3}=+\s*$/,replacement:'<span class="TMMark TMMark_TMSetextH1Marker">$0</span>'},TMSetextH2Marker:{regexp:/^ {0,3}-+\s*$/,replacement:'<span class="TMMark TMMark_TMSetextH1Marker">$0</span>'},TMHR:{regexp:/^( {0,3}(\*[ \t]*\*[ \t]*\*[ \t*]*)|(-[ \t]*-[ \t]*-[ \t-]*)|(_[ \t]*_[ \t]*_[ \t_]*))$/,replacement:'<span class="TMMark TMMark_TMHR">$0</span>'},TMUL:{regexp:/^( {0,3}[+*-] {1,4})(.*)$/,replacement:'<span class="TMMark TMMark_TMUL">$1</span>$$2'},TMOL:{regexp:/^( {0,3}\d{1,9}[.)] {1,4})(.*)$/,replacement:'<span class="TMMark TMMark_TMOL">$1</span>$$2'},TMIndentedCode:{regexp:/^( {4}|\t)(.*)$/,replacement:'<span class="TMMark TMMark_TMIndentedCode">$1</span>$2'},TMLinkReferenceDefinition:{regexp:/^( {0,3}\[\s*)([^\s\]](?:[^\]]|\\\])*?)(\s*\]:\s*)((?:[^\s<>]+)|(?:<(?:[^<>\\]|\\.)*>))?(\s*)((?:\((?:[^()\\]|\\.)*\))|(?:"(?:[^"\\]|\\.)*")|(?:'(?:[^'\\]|\\.)*'))?(\s*)$/,replacement:'<span class="TMMark TMMark_TMLinkReferenceDefinition">$1</span><span class="TMLinkLabel TMLinkLabel_Definition">$2</span><span class="TMMark TMMark_TMLinkReferenceDefinition">$3</span><span class="TMLinkDestination">$4</span>$5<span class="TMLinkTitle">$6</span>$7',labelPlaceholder:2}},r.htmlBlockGrammar=[{start:/^ {0,3}<(?:script|pre|style)(?:\s|>|$)/i,end:/(?:<\/script>|<\/pre>|<\/style>)/i,paraInterrupt:!0},{start:/^ {0,3}<!--/,end:/-->/,paraInterrupt:!0},{start:/^ {0,3}<\?/,end:/\?>/,paraInterrupt:!0},{start:/^ {0,3}<![A-Z]/,end:/>/,paraInterrupt:!0},{start:/^ {0,3}<!\[CDATA\[/,end:/\]\]>/,paraInterrupt:!0},{start:/^ {0,3}(?:<|<\/)(?:KnownTag)(?:\s|>|\/>|$)/i,end:!1,paraInterrupt:!0},{start:/^ {0,3}(?:HTMLOpenTag|HTMLCloseTag)\s*$/,end:!1,paraInterrupt:!1}],r.inlineGrammar={escape:{regexp:/^\\(ASCIIPunctuation)/,replacement:'<span class="TMMark TMMark_TMEscape">\\</span>$1'},code:{regexp:/^(`+)((?:[^`])|(?:[^`].*?[^`]))(\1)/,replacement:'<span class="TMMark TMMark_TMCode">$1</span><code class="TMCode">$2</code><span class="TMMark TMMark_TMCode">$3</span>'},autolink:{regexp:/^<((?:Scheme:[^\s<>]*)|(?:Email))>/,replacement:'<span class="TMMark TMMark_TMAutolink">&lt;</span><span class="TMAutolink">$1</span><span class="TMMark TMMark_TMAutolink">&gt;</span>'},html:{regexp:/^((?:HTMLOpenTag)|(?:HTMLCloseTag)|(?:HTMLComment)|(?:HTMLPI)|(?:HTMLDeclaration)|(?:HTMLCDATA))/,replacement:'<span class="TMHTML">$1</span>'},linkOpen:{regexp:/^\[/,replacement:""},imageOpen:{regexp:/^!\[/,replacement:""},linkLabel:{regexp:/^(\[\s*)([^\]]*?)(\s*\])/,replacement:"",labelPlaceholder:2},default:{regexp:/^(.|(?:NotTriggerChar+))/,replacement:"$1"}};const m=new RegExp(Object.keys(c).join("|")),e=[...Object.keys(r.inlineGrammar)];for(let n of e){let s=r.inlineGrammar[n].regexp.source;for(;s.match(m);)s=s.replace(m,a=>c[a].source);r.inlineGrammar[n].regexp=new RegExp(s,r.inlineGrammar[n].regexp.flags)}for(let n of r.htmlBlockGrammar){let s=n.start.source;for(;s.match(m);)s=s.replace(m,a=>c[a].source);n.start=new RegExp(s,n.start.flags)}function i(n={}){const s={...r.inlineGrammar};for(const[a,o]of Object.entries(n)){const u={...o};let h=o.regexp.source;const d=new RegExp(Object.keys(c).join("|"));for(;h.match(d);)h=h.replace(d,l=>c[l].source);u.regexp=new RegExp(h,o.regexp.flags),s[a]=u}return s}function t(n){return(n||"").replace(/&/g,"&amp;").replace(/</g,"&lt;").replace(/>/g,"&gt;")}r.commands={bold:{type:"inline",className:"TMStrong",set:{pre:"**",post:"**"},unset:{prePattern:/(?:\*\*|__)$/,postPattern:/^(?:\*\*|__)/}},italic:{type:"inline",className:"TMEm",set:{pre:"*",post:"*"},unset:{prePattern:/(?:\*|_)$/,postPattern:/^(?:\*|_)/}},code:{type:"inline",className:"TMCode",set:{pre:"`",post:"`"},unset:{prePattern:/`+$/,postPattern:/^`+/}},strikethrough:{type:"inline",className:"TMStrikethrough",set:{pre:"~~",post:"~~"},unset:{prePattern:/~~$/,postPattern:/^~~/}},h1:{type:"line",className:"TMH1",set:{pattern:/^( {0,3}(?:(?:#+|[0-9]{1,9}[).]|[>\-*+])\s+)?)(.*)$/,replacement:"# $2"},unset:{pattern:/^( {0,3}#\s+)(.*?)((?:\s+#+\s*)?)$/,replacement:"$2"}},h2:{type:"line",className:"TMH2",set:{pattern:/^( {0,3}(?:(?:#+|[0-9]{1,9}[).]|[>\-*+])\s+)?)(.*)$/,replacement:"## $2"},unset:{pattern:/^( {0,3}##\s+)(.*?)((?:\s+#+\s*)?)$/,replacement:"$2"}},h3:{type:"line",className:"TMH3",set:{pattern:/^( {0,3}(?:(?:#+|[0-9]{1,9}[).]|[>\-*+])\s+)?)(.*)$/,replacement:"### $2"},unset:{pattern:/^( {0,3}###\s+)(.*?)((?:\s+#+\s*)?)$/,replacement:"$2"}},h4:{type:"line",className:"TMH4",set:{pattern:/^( {0,3}(?:(?:#+|[0-9]{1,9}[).]|[>\-*+])\s+)?)(.*)$/,replacement:"#### $2"},unset:{pattern:/^( {0,3}####\s+)(.*?)((?:\s+#+\s*)?)$/,replacement:"$2"}},h5:{type:"line",className:"TMH5",set:{pattern:/^( {0,3}(?:(?:#+|[0-9]{1,9}[).]|[>\-*+])\s+)?)(.*)$/,replacement:"##### $2"},unset:{pattern:/^( {0,3}#####\s+)(.*?)((?:\s+#+\s*)?)$/,replacement:"$2"}},h6:{type:"line",className:"TMH6",set:{pattern:/^( {0,3}(?:(?:#+|[0-9]{1,9}[).]|[>\-*+])\s+)?)(.*)$/,replacement:"###### $2"},unset:{pattern:/^( {0,3}######\s+)(.*?)((?:\s+#+\s*)?)$/,replacement:"$2"}},ul:{type:"line",className:"TMUL",set:{pattern:/^( {0,3}(?:(?:#+|[0-9]{1,9}[).]|[>\-*+])\s+)?)(.*)$/,replacement:"- $2"},unset:{pattern:/^( {0,3}[+*-] {1,4})(.*)$/,replacement:"$2"}},ol:{type:"line",className:"TMOL",set:{pattern:/^( {0,3}(?:(?:#+|[0-9]{1,9}[).]|[>\-*+])\s+)?)(.*)$/,replacement:"$#. $2"},unset:{pattern:/^( {0,3}\d{1,9}[.)] {1,4})(.*)$/,replacement:"$2"}},blockquote:{type:"line",className:"TMBlockquote",set:{pattern:/^( {0,3}(?:(?:#+|[0-9]{1,9}[).]|[>\-*+])\s+)?)(.*)$/,replacement:"> $2"},unset:{pattern:/^( {0,3}>[ ]?)(.*)$/,replacement:"$2"}}}}(K)),K}var ce;function et(){if(ce)return P;ce=1,Object.defineProperty(P,"__esModule",{value:!0}),P.Editor=void 0;const r=Je();class c{constructor(e={}){this.e=null,this.textarea=null,this.lines=[],this.lineElements=[],this.lineTypes=[],this.lineCaptures=[],this.lineReplacements=[],this.linkLabels=[],this.lineDirty=[],this.lastCommandState=null,this.customInlineGrammar={},this.mergedInlineGrammar=r.inlineGrammar,this.listeners={change:[],selection:[],drop:[]},this.undoStack=[],this.redoStack=[],this.isRestoringHistory=!1,this.maxHistory=100,this.e=null,this.textarea=null,this.lines=[],this.lineElements=[],this.lineTypes=[],this.lineCaptures=[],this.lineReplacements=[],this.linkLabels=[],this.lineDirty=[],this.lastCommandState=null,this.customInlineGrammar=e.customInlineGrammar||{},this.mergedInlineGrammar=(0,r.createMergedInlineGrammar)(this.customInlineGrammar),this.listeners={change:[],selection:[],drop:[]};let i=null;typeof e.element=="string"?i=document.getElementById(e.element):e.element&&(i=e.element),typeof e.textarea=="string"?this.textarea=document.getElementById(e.textarea):e.textarea&&(this.textarea=e.textarea),this.textarea&&(i||(i=this.textarea)),i||(i=document.getElementsByTagName("body")[0]),i&&i.tagName==="TEXTAREA"&&(this.textarea=i,i=this.textarea.parentNode),this.textarea&&(this.textarea.style.display="none"),this.undoStack=[],this.redoStack=[],this.isRestoringHistory=!1,this.maxHistory=100,this.createEditorElement(i,e),this.setContent(typeof e.content=="string"?e.content:this.textarea?this.textarea.value:`# Hello TinyMDE!
Edit **here**`),this.e.addEventListener("keydown",t=>this.handleUndoRedoKey(t))}get canUndo(){return this.undoStack.length>=2}get canRedo(){return this.redoStack.length>0}pushHistory(){this.isRestoringHistory||(this.pushCurrentState(),this.redoStack=[])}pushCurrentState(){this.undoStack.push({content:this.getContent(),selection:this.getSelection(),anchor:this.getSelection(!0)}),this.undoStack.length>this.maxHistory&&this.undoStack.shift()}undo(){if(this.undoStack.length<2)return;this.isRestoringHistory=!0,this.pushCurrentState();const e=this.undoStack.pop();this.redoStack.push(e);const i=this.undoStack[this.undoStack.length-1];this.setContent(i.content),i.selection&&this.setSelection(i.selection,i.anchor),this.undoStack.pop(),this.isRestoringHistory=!1}redo(){if(!this.redoStack.length)return;this.isRestoringHistory=!0,this.pushCurrentState();const e=this.redoStack.pop();this.setContent(e.content),e.selection&&this.setSelection(e.selection,e.anchor),this.isRestoringHistory=!1}handleUndoRedoKey(e){(/Mac|iPod|iPhone|iPad/.test(navigator.platform)?e.metaKey:e.ctrlKey)&&!e.altKey&&(e.key==="z"||e.key==="Z"?(e.shiftKey?this.redo():this.undo(),e.preventDefault()):(e.key==="y"||e.key==="Y")&&(this.redo(),e.preventDefault()))}createEditorElement(e,i){i&&i.editor!==void 0?typeof i.editor=="string"?this.e=document.getElementById(i.editor):this.e=i.editor:this.e=document.createElement("div"),this.e.classList.add("TinyMDE"),this.e.contentEditable="true",this.e.style.whiteSpace="pre-wrap",this.e.style.webkitUserModify="read-write-plaintext-only",i.editor===void 0&&(this.textarea&&this.textarea.parentNode===e&&this.textarea.nextSibling?e.insertBefore(this.e,this.textarea.nextSibling):e.appendChild(this.e)),this.e.addEventListener("input",t=>this.handleInputEvent(t)),this.e.addEventListener("compositionend",t=>this.handleInputEvent(t)),document.addEventListener("selectionchange",t=>this.handleSelectionChangeEvent(t)),this.e.addEventListener("paste",t=>this.handlePaste(t)),this.e.addEventListener("drop",t=>this.handleDrop(t)),this.lineElements=this.e.childNodes}setContent(e){for(;this.e.firstChild;)this.e.removeChild(this.e.firstChild);this.lines=e.split(/(?:\r\n|\r|\n)/),this.lineDirty=[];for(let i=0;i<this.lines.length;i++){let t=document.createElement("div");this.e.appendChild(t),this.lineDirty.push(!0)}this.lineTypes=new Array(this.lines.length),this.updateFormatting(),this.fireChange(),this.isRestoringHistory||this.pushHistory()}getContent(){return this.lines.join(`
`)}updateFormatting(){this.updateLineTypes(),this.updateLinkLabels(),this.applyLineTypes()}updateLinkLabels(){this.linkLabels=[];for(let e=0;e<this.lines.length;e++)this.lineTypes[e]==="TMLinkReferenceDefinition"&&this.linkLabels.push(this.lineCaptures[e][r.lineGrammar.TMLinkReferenceDefinition.labelPlaceholder])}replace(e,i){return e.replace(/(\${1,2})([0-9])/g,(t,n,s)=>n==="$"?(0,r.htmlescape)(i[parseInt(s)]):`<span class="TMInlineFormatted">${this.processInlineStyles(i[parseInt(s)])}</span>`)}applyLineTypes(){for(let e=0;e<this.lines.length;e++){if(this.lineDirty[e]){let i=this.replace(this.lineReplacements[e],this.lineCaptures[e]);this.lineElements[e].className=this.lineTypes[e],this.lineElements[e].removeAttribute("style"),this.lineElements[e].innerHTML=i===""?"<br />":i}this.lineElements[e].dataset.lineNum=e.toString()}}updateLineTypes(){let e=!1,i=0,t=!1;for(let n=0;n<this.lines.length;n++){let s="TMPara",a=[this.lines[n]],o="$$0";if(e==="TMCodeFenceBacktickOpen"){let u=r.lineGrammar.TMCodeFenceBacktickClose.regexp.exec(this.lines[n]);u&&u.groups.seq.length>=i?(s="TMCodeFenceBacktickClose",o=r.lineGrammar.TMCodeFenceBacktickClose.replacement,a=u,e=!1):(s="TMFencedCodeBacktick",o='<span class="TMFencedCode">$0<br /></span>',a=[this.lines[n]])}else if(e==="TMCodeFenceTildeOpen"){let u=r.lineGrammar.TMCodeFenceTildeClose.regexp.exec(this.lines[n]);u&&u.groups.seq.length>=i?(s="TMCodeFenceTildeClose",o=r.lineGrammar.TMCodeFenceTildeClose.replacement,a=u,e=!1):(s="TMFencedCodeTilde",o='<span class="TMFencedCode">$0<br /></span>',a=[this.lines[n]])}if(s==="TMPara"&&t===!1){for(let u of r.htmlBlockGrammar)if(this.lines[n].match(u.start)&&(u.paraInterrupt||n===0||!(this.lineTypes[n-1]==="TMPara"||this.lineTypes[n-1]==="TMUL"||this.lineTypes[n-1]==="TMOL"||this.lineTypes[n-1]==="TMBlockquote"))){t=u;break}}if(t!==!1&&(s="TMHTMLBlock",o='<span class="TMHTMLContent">$0<br /></span>',a=[this.lines[n]],t.end?this.lines[n].match(t.end)&&(t=!1):(n===this.lines.length-1||this.lines[n+1].match(r.lineGrammar.TMBlankLine.regexp))&&(t=!1)),s==="TMPara"){for(let u in r.lineGrammar)if(r.lineGrammar[u].regexp){let h=r.lineGrammar[u].regexp.exec(this.lines[n]);if(h){s=u,o=r.lineGrammar[u].replacement,a=h;break}}}if((s==="TMCodeFenceBacktickOpen"||s==="TMCodeFenceTildeOpen")&&(e=s,i=a.groups.seq.length),(s==="TMIndentedCode"||s==="TMLinkReferenceDefinition")&&n>0&&(this.lineTypes[n-1]==="TMPara"||this.lineTypes[n-1]==="TMUL"||this.lineTypes[n-1]==="TMOL"||this.lineTypes[n-1]==="TMBlockquote")&&(s="TMPara",a=[this.lines[n]],o="$$0"),s==="TMSetextH2Marker"){let u=r.lineGrammar.TMUL.regexp.exec(this.lines[n]);u&&(s="TMUL",o=r.lineGrammar.TMUL.replacement,a=u)}if(s==="TMSetextH1Marker"||s==="TMSetextH2Marker")if(n===0||this.lineTypes[n-1]!=="TMPara"){let u=r.lineGrammar.TMHR.regexp.exec(this.lines[n]);u?(s="TMHR",a=u,o=r.lineGrammar.TMHR.replacement):(s="TMPara",a=[this.lines[n]],o="$$0")}else{let u=n-1;const h=s==="TMSetextH1Marker"?"TMSetextH1":"TMSetextH2";do this.lineTypes[u]!==h&&(this.lineTypes[u]=h,this.lineDirty[u]=!0),this.lineReplacements[u]="$$0",this.lineCaptures[u]=[this.lines[u]],u--;while(u>=0&&this.lineTypes[u]==="TMPara")}this.lineTypes[n]!==s&&(this.lineTypes[n]=s,this.lineDirty[n]=!0),this.lineReplacements[n]=o,this.lineCaptures[n]=a}}getSelection(e=!1){var i,t;const n=window.getSelection();let s=e?n.anchorNode:n.focusNode;if(!s)return null;let a=e?n.anchorOffset:n.focusOffset;if(s===this.e)return a<this.lines.length?{row:a,col:0}:{row:a-1,col:this.lines[a-1].length};let o=this.computeColumn(s,a);if(o===null)return null;let u=s;for(;u.parentElement!==this.e;)u=u.parentElement;let h=0;if(u.previousSibling){const d=(i=u.dataset)===null||i===void 0?void 0:i.lineNum,l=(t=u.previousSibling.dataset)===null||t===void 0?void 0:t.lineNum;if(d&&l){const T=parseInt(d),f=parseInt(l);if(T===f+1)h=T;else for(;u.previousSibling;)h++,u=u.previousSibling}}return{row:h,col:o}}setSelection(e,i=null){if(!e)return;let{node:t,offset:n}=this.computeNodeAndOffset(e.row,e.col,i?i.row===e.row&&i.col>e.col:!1),s=null,a=null;if(i&&(i.row!==e.row||i.col!==e.col)){let{node:u,offset:h}=this.computeNodeAndOffset(i.row,i.col,e.row===i.row&&e.col>i.col);s=u,a=h}window.getSelection().setBaseAndExtent(t,n,s||t,s?a:n)}paste(e,i=null,t=null){i||(i=this.getSelection(!0)),t||(t=this.getSelection(!1));let n,s;t||(t={row:this.lines.length-1,col:this.lines[this.lines.length-1].length}),i||(i=t),i.row<t.row||i.row===t.row&&i.col<=t.col?(n=i,s=t):(n=t,s=i);let a=e.split(/(?:\r\n|\r|\n)/),o=this.lines[n.row].substr(0,n.col),u=this.lines[s.row].substr(s.col);a[0]=o.concat(a[0]);let h=a[a.length-1].length;a[a.length-1]=a[a.length-1].concat(u),this.spliceLines(n.row,1+s.row-n.row,a),t.row=n.row+a.length-1,t.col=h,this.updateFormatting(),this.setSelection(t),this.fireChange()}wrapSelection(e,i,t=null,n=null){if(this.isRestoringHistory||this.pushHistory(),t||(t=this.getSelection(!1)),n||(n=this.getSelection(!0)),!t||!n||t.row!==n.row)return;this.lineDirty[t.row]=!0;const s=t.col<n.col?t.col:n.col,a=t.col<n.col?n.col:t.col,o=this.lines[t.row].substr(0,s).concat(e),u=a===s?"":this.lines[t.row].substr(s,a-s),h=i.concat(this.lines[t.row].substr(a));this.lines[t.row]=o.concat(u,h),n.col=o.length,t.col=n.col+u.length,this.updateFormatting(),this.setSelection(t,n)}addEventListener(e,i){e.match(/^(?:change|input)$/i)&&this.listeners.change.push(i),e.match(/^(?:selection|selectionchange)$/i)&&this.listeners.selection.push(i),e.match(/^(?:drop)$/i)&&this.listeners.drop.push(i)}fireChange(){if(!this.textarea&&!this.listeners.change.length)return;const e=this.getContent();this.textarea&&(this.textarea.value=e);for(let i of this.listeners.change)i({content:e,linesDirty:[...this.lineDirty]})}handleInputEvent(e){const i=e;if(i.inputType==="insertCompositionText")return;this.isRestoringHistory||this.pushHistory();let t=this.getSelection();(i.inputType==="insertParagraph"||i.inputType==="insertLineBreak")&&t?(this.clearDirtyFlag(),this.processNewParagraph(t)):(this.e.firstChild?this.fixNodeHierarchy():this.e.innerHTML='<div class="TMBlankLine"><br></div>',this.updateLineContentsAndFormatting()),t&&this.setSelection(t),this.fireChange()}handleSelectionChangeEvent(e){this.fireSelection()}handlePaste(e){this.isRestoringHistory||this.pushHistory(),e.preventDefault();let i=e.clipboardData.getData("text/plain");this.paste(i)}handleDrop(e){e.preventDefault(),this.fireDrop(e.dataTransfer)}processInlineStyles(e){let i="",t=[],n=0,s=e;e:for(;s;){for(let h of["escape","code","autolink","html"])if(this.mergedInlineGrammar[h]){let d=this.mergedInlineGrammar[h].regexp.exec(s);if(d){s=s.substr(d[0].length),n+=d[0].length,i+=this.mergedInlineGrammar[h].replacement.replace(/\$([1-9])/g,(l,T)=>(0,r.htmlescape)(d[T]));continue e}}for(let h in this.customInlineGrammar)if(h!=="escape"&&h!=="code"&&h!=="autolink"&&h!=="html"&&h!=="linkOpen"&&h!=="imageOpen"&&h!=="linkLabel"&&h!=="default"){let d=this.mergedInlineGrammar[h].regexp.exec(s);if(d){s=s.substr(d[0].length),n+=d[0].length,i+=this.mergedInlineGrammar[h].replacement.replace(/\$([1-9])/g,(l,T)=>(0,r.htmlescape)(d[T]));continue e}}let a=s.match(this.mergedInlineGrammar.linkOpen.regexp),o=s.match(this.mergedInlineGrammar.imageOpen.regexp);if(o||a){let h=this.parseLinkOrImage(s,!!o);if(h){i=`${i}${h.output}`,s=s.substr(h.charCount),n+=h.charCount;continue e}}let u=/(^\*+)|(^_+)/.exec(s);if(u){let h=u[0].length;const d=u[0],l=u[0][0];s=s.substr(u[0].length);const T=n>0?e.substr(0,n):" ",f=n+u[0].length<e.length?s:" ",g=f.match(r.punctuationLeading),p=T.match(r.punctuationTrailing),b=f.match(/^\s/),A=T.match(/\s$/);let x=!b&&(!g||!!A||!!p),L=!A&&(!p||!!b||!!g);if(l==="_"&&x&&L&&(x=!!p,L=!!g),L){let y=t.length-1;for(;h&&y>=0;)if(t[y].delimiter===l){for(;y<t.length-1;){const H=t.pop();i=`${H.output}${H.delimString.substr(0,H.count)}${i}`}h>=2&&t[y].count>=2?(i=`<span class="TMMark">${l}${l}</span><strong class="TMStrong">${i}</strong><span class="TMMark">${l}${l}</span>`,h-=2,t[y].count-=2):(i=`<span class="TMMark">${l}</span><em class="TMEm">${i}</em><span class="TMMark">${l}</span>`,h-=1,t[y].count-=1),t[y].count===0&&(i=`${t.pop().output}${i}`,y--)}else y--}h&&x&&(t.push({delimiter:l,delimString:d,count:h,output:i}),i="",h=0),h&&(i=`${i}${d.substr(0,h)}`),n+=u[0].length;continue e}if(u=/^~~/.exec(s),u){let h=!1,d=t.length-1;for(;!h&&d>=0;)if(t[d].delimiter==="~"){for(;d<t.length-1;){const T=t.pop();i=`${T.output}${T.delimString.substr(0,T.count)}${i}`}i=`<span class="TMMark">~~</span><del class="TMStrikethrough">${i}</del><span class="TMMark">~~</span>`,i=`${t.pop().output}${i}`,h=!0}else d--;h||(t.push({delimiter:"~",delimString:"~~",count:2,output:i}),i=""),n+=u[0].length,s=s.substr(u[0].length);continue e}if(u=this.mergedInlineGrammar.default.regexp.exec(s),u){s=s.substr(u[0].length),n+=u[0].length,i+=this.mergedInlineGrammar.default.replacement.replace(/\$([1-9])/g,(h,d)=>(0,r.htmlescape)(u[d]));continue e}throw"Infinite loop!"}for(;t.length;){const a=t.pop();i=`${a.output}${a.delimString.substr(0,a.count)}${i}`}return i}computeColumn(e,i){let t=e,n;for(;t&&t.parentNode!==this.e;)t=t.parentNode;if(t===null)return null;for(e.nodeType===Node.TEXT_NODE||i===0?(n=i,t=e):i>0?(t=e.childNodes[i-1],n=t.textContent.length):(n=0,t=e);t.parentNode!==this.e;)t.previousSibling?(t=t.previousSibling,n+=t.textContent.length):t=t.parentNode;return n}computeNodeAndOffset(e,i,t=!1){e>=this.lineElements.length&&(e=this.lineElements.length-1,i=this.lines[e].length),i>this.lines[e].length&&(i=this.lines[e].length);const n=this.lineElements[e];let s=n.firstChild,a=!1,o={node:n.firstChild?n.firstChild:n,offset:0};for(;s!==n;){if(!a&&s.nodeType===Node.TEXT_NODE)if(s.nodeValue.length>=i)if(t&&s.nodeValue.length===i)o={node:s,offset:i},i=0;else return{node:s,offset:i};else i-=s.nodeValue.length;!a&&s.firstChild?s=s.firstChild:s.nextSibling?(a=!1,s=s.nextSibling):(a=!0,s=s.parentNode)}return o}updateLineContentsAndFormatting(){this.clearDirtyFlag(),this.updateLineContents(),this.updateFormatting()}clearDirtyFlag(){this.lineDirty=new Array(this.lines.length);for(let e=0;e<this.lineDirty.length;e++)this.lineDirty[e]=!1}updateLineContents(){let e=this.e.childElementCount-this.lines.length;if(e){let i=0;for(;i<=this.lines.length&&i<=this.lineElements.length&&this.lineElements[i]&&this.lines[i]===this.lineElements[i].textContent&&this.lineTypes[i]===this.lineElements[i].className;)i++;let t=-1;for(;-t<this.lines.length&&-t<this.lineElements.length&&this.lines[this.lines.length+t]===this.lineElements[this.lineElements.length+t].textContent&&this.lineTypes[this.lines.length+t]===this.lineElements[this.lineElements.length+t].className;)t--;let n=this.lines.length+t+1-i;n<-e&&(n=-e),n<0&&(n=0);let s=[];for(let a=0;a<n+e;a++)s.push(this.lineElements[i+a].textContent||"");this.spliceLines(i,n,s,!1)}else for(let i=0;i<this.lineElements.length;i++){let t=this.lineElements[i],n=t.textContent||"";(this.lines[i]!==n||this.lineTypes[i]!==t.className)&&(this.lines[i]=n,this.lineTypes[i]=t.className,this.lineDirty[i]=!0)}}processNewParagraph(e){if(!e)return;this.updateLineContents();let i=!1,t=e.col>0?e.row:e.row-1;switch(this.lineTypes[t]){case"TMUL":i="TMUL";break;case"TMOL":i="TMOL";break;case"TMIndentedCode":i="TMIndentedCode";break}let n=this.lines[e.row].replace(/\n\n$/,`
`).split(/(?:\r\n|\n|\r)/);if(n.length>1&&(this.spliceLines(e.row,1,n,!0),e.row++,e.col=0),i){let s=r.lineGrammar[i].regexp.exec(this.lines[e.row-1]);s&&(s[2]?(i==="TMOL"&&(s[1]=s[1].replace(/\d{1,9}/,a=>(parseInt(a)+1).toString())),this.lines[e.row]=`${s[1]}${this.lines[e.row]}`,this.lineDirty[e.row]=!0,e.col=s[1].length):(this.lines[e.row-1]="",this.lineDirty[e.row-1]=!0))}this.updateFormatting()}spliceLines(e,i=0,t=[],n=!0){if(n)for(let o=0;o<i;o++)this.e.removeChild(this.e.childNodes[e]);let s=[],a=[];for(let o=0;o<t.length;o++)s.push(""),a.push(!0),n&&(this.e.childNodes[e]?this.e.insertBefore(document.createElement("div"),this.e.childNodes[e]):this.e.appendChild(document.createElement("div")));this.lines.splice(e,i,...t),this.lineTypes.splice(e,i,...s),this.lineDirty.splice(e,i,...a)}fixNodeHierarchy(){const e=Array.from(this.e.childNodes),i=(t,...n)=>{const s=t.parentElement,a=t.nextSibling;s.removeChild(t),n.forEach(o=>a?s.insertBefore(o,a):s.appendChild(o))};e.forEach(t=>{if(t.nodeType!==Node.ELEMENT_NODE||t.tagName!=="DIV"){const n=document.createElement("div");i(t,n),n.appendChild(t)}else if(t.childNodes.length===0)t.appendChild(document.createElement("br"));else{const n=Array.from(t.childNodes);if(n.some(s=>s.nodeType===Node.ELEMENT_NODE&&s.tagName==="DIV"))return i(t,...n)}})}parseLinkOrImage(e,i){let t=i?2:1,n=e.substr(0,t),s=i?"TMImage":"TMLink",a=t,o=1,u=!1,h=!1,d=[],l=[];e:for(;a<e.length&&u===!1;){let f=e.substr(a);for(let g of["escape","code","autolink","html"]){let p=this.mergedInlineGrammar[g].regexp.exec(f);if(p){a+=p[0].length;continue e}}if(f.match(this.mergedInlineGrammar.imageOpen.regexp)){o++,a+=2;continue e}if(f.match(this.mergedInlineGrammar.linkOpen.regexp)){if(o++,!i&&this.parseLinkOrImage(f,!1))return!1;a+=1;continue e}if(f.match(/^\]/)&&(o--,o===0)){u=e.substr(t,a-t),a++;continue e}a++}if(u===!1)return!1;let T=a<e.length?e.substr(a,1):"";if(T==="["){let f=e.substr(a),g=this.mergedInlineGrammar.linkLabel.regexp.exec(f);if(g)a+=g[0].length,d.push(g[1],g[2],g[3]),g[this.mergedInlineGrammar.linkLabel.labelPlaceholder]?h=g[this.mergedInlineGrammar.linkLabel.labelPlaceholder]:h=u.trim();else return!1}else if(T!=="(")h=u.trim();else{a++;let f=1;e:for(;a<e.length&&f>0;){let g=e.substr(a),p=/^\s+/.exec(g);if(p){switch(l.length){case 0:l.push(p[0]);break;case 1:l.push(p[0]);break;case 2:if(l[0].match(/</))l[1]=l[1].concat(p[0]);else{if(f!==1)return!1;l.push(""),l.push(p[0])}break;case 3:l.push(p[0]);break;case 4:return!1;case 5:l.push("");case 6:l[5]=l[5].concat(p[0]);break;case 7:l[6]=l[6].concat(p[0]);break;default:return!1}a+=p[0].length;continue e}if(p=this.mergedInlineGrammar.escape.regexp.exec(g),p){switch(l.length){case 0:l.push("");case 1:l.push(p[0]);break;case 2:l[1]=l[1].concat(p[0]);break;case 3:return!1;case 4:return!1;case 5:l.push("");case 6:l[5]=l[5].concat(p[0]);break;default:return!1}a+=p[0].length;continue e}if(l.length<2&&g.match(/^</)){l.length===0&&l.push(""),l[0]=l[0].concat("<"),a++;continue e}if((l.length===1||l.length===2)&&g.match(/^>/)){l.length===1&&l.push(""),l.push(">"),a++;continue e}if(p=/^["']/.exec(g),p&&(l.length===0||l.length===1||l.length===4)){for(;l.length<4;)l.push("");l.push(p[0]),a++;continue e}if(p&&(l.length===5||l.length===6)&&l[4]===p[0]){l.length===5&&l.push(""),l.push(p[0]),a++;continue e}if(g.match(/^\(/)){switch(l.length){case 0:l.push("");case 1:l.push("");case 2:l[1]=l[1].concat("("),l[0].match(/<$/)||f++;break;case 3:l.push("");case 4:l.push("(");break;case 5:l.push("");case 6:if(l[4]==="(")return!1;l[5]=l[5].concat("(");break;default:return!1}a++;continue e}if(g.match(/^\)/)){if(l.length<=2){for(;l.length<2;)l.push("");l[0].match(/<$/)||f--,f>0&&(l[1]=l[1].concat(")"))}else l.length===5||l.length===6?l[4]==="("?(l.length===5&&l.push(""),l.push(")")):l.length===5?l.push(")"):l[5]=l[5].concat(")"):f--;if(f===0)for(;l.length<7;)l.push("");a++;continue e}if(p=/^./.exec(g),p){switch(l.length){case 0:l.push("");case 1:l.push(p[0]);break;case 2:l[1]=l[1].concat(p[0]);break;case 3:return!1;case 4:return!1;case 5:l.push("");case 6:l[5]=l[5].concat(p[0]);break;default:return!1}a+=p[0].length;continue e}throw"Infinite loop"}if(f>0)return!1}if(h!==!1){let f=!1;for(let b of this.linkLabels)if(b===h){f=!0;break}let g=f?"TMLinkLabel TMLinkLabel_Valid":"TMLinkLabel TMLinkLabel_Invalid",p=`<span class="TMMark TMMark_${s}">${n}</span><span class="${s} ${d.length<3||!d[1]?g:""}">${this.processInlineStyles(u)}</span><span class="TMMark TMMark_${s}">]</span>`;return d.length>=3&&(p=p.concat(`<span class="TMMark TMMark_${s}">${d[0]}</span>`,`<span class="${g}">${d[1]}</span>`,`<span class="TMMark TMMark_${s}">${d[2]}</span>`)),{output:p,charCount:a}}else if(l.length>0){for(;l.length<7;)l.push("");return{output:`<span class="TMMark TMMark_${s}">${n}</span><span class="${s}">${this.processInlineStyles(u)}</span><span class="TMMark TMMark_${s}">](${l[0]}</span><span class="${s}Destination">${l[1]}</span><span class="TMMark TMMark_${s}">${l[2]}${l[3]}${l[4]}</span><span class="${s}Title">${l[5]}</span><span class="TMMark TMMark_${s}">${l[6]})</span>`,charCount:a}}return!1}computeCommonAncestor(e,i){if(!e||!i)return null;if(e===i)return e;const t=o=>{let u=[];for(;o;)u.unshift(o),o=o.parentNode;return u},n=t(e),s=t(i);if(n[0]!==s[0])return null;let a;for(a=0;n[a]===s[a];a++);return n[a-1]}computeEnclosingMarkupNode(e,i,t){let n=null;if(!e)return null;if(i){if(e.row!==i.row)return null;const s=window.getSelection();if(!s)return null;n=this.computeCommonAncestor(s.focusNode,s.anchorNode)}else{const s=window.getSelection();if(!s||!s.focusNode)return null;n=s.focusNode}if(!n)return null;for(;n!==this.e;){if(n.className&&n.className.includes(t))return n;n=n.parentNode}return null}getCommandState(e=null,i=null){let t={};if(e||(e=this.getSelection(!1)),i||(i=this.getSelection(!0)),!e){for(let a in r.commands)t[a]=null;return t}i||(i=e);let n,s;i.row<e.row||i.row===e.row&&i.col<e.col?(n=i,s=e):(n=e,s=i),s.row>n.row&&s.col===0&&(s.row--,s.col=this.lines[s.row].length);for(let a in r.commands)if(r.commands[a].type==="inline"&&(!e||e.row!==i.row||!this.isInlineFormattingAllowed()?t[a]=null:t[a]=!!this.computeEnclosingMarkupNode(e,i,r.commands[a].className)||e.col===i.col&&!!this.lines[e.row].substr(0,e.col).match(r.commands[a].unset.prePattern)&&!!this.lines[e.row].substr(e.col).match(r.commands[a].unset.postPattern)),r.commands[a].type==="line")if(!e)t[a]=null;else{let o=this.lineTypes[n.row]===r.commands[a].className;for(let u=n.row;u<=s.row;u++)if(this.lineTypes[u]===r.commands[a].className!==o){o=null;break}t[a]=o}return t}setCommandState(e,i){if(this.isRestoringHistory||this.pushHistory(),r.commands[e].type==="inline"){let t=this.getSelection(!0),n=this.getSelection(!1);if(t||(t=n),!t||t.row!==n.row||!this.isInlineFormattingAllowed())return;let s=this.computeEnclosingMarkupNode(n,t,r.commands[e].className);if(this.clearDirtyFlag(),s){this.lineDirty[n.row]=!0;const a=this.computeColumn(s,0),o=s.textContent.length,u=this.lines[n.row].substr(0,a).replace(r.commands[e].unset.prePattern,""),h=this.lines[n.row].substr(a,o),d=this.lines[n.row].substr(a+o).replace(r.commands[e].unset.postPattern,"");this.lines[n.row]=u.concat(h,d),t.col=u.length,n.col=t.col+o,this.updateFormatting(),this.setSelection(n,t),this.fireChange()}else if(n.col===t.col&&this.lines[n.row].substr(0,n.col).match(r.commands[e].unset.prePattern)&&this.lines[n.row].substr(n.col).match(r.commands[e].unset.postPattern)){this.lineDirty[n.row]=!0;const a=this.lines[n.row].substr(0,n.col).replace(r.commands[e].unset.prePattern,""),o=this.lines[n.row].substr(n.col).replace(r.commands[e].unset.postPattern,"");this.lines[n.row]=a.concat(o),n.col=t.col=a.length,this.updateFormatting(),this.setSelection(n,t),this.fireChange()}else{let{startCol:a,endCol:o}=n.col<t.col?{startCol:n.col,endCol:t.col}:{startCol:t.col,endCol:n.col},u=this.lines[n.row].substr(a,o-a).match(/^(?<leading>\s*).*\S(?<trailing>\s*)$/);u&&(a+=u.groups.leading.length,o-=u.groups.trailing.length),n.col=a,t.col=o,this.wrapSelection(r.commands[e].set.pre,r.commands[e].set.post,n,t),this.fireChange()}}else if(r.commands[e].type==="line"){let t=this.getSelection(!0),n=this.getSelection(!1);if(t||(t=n),!n)return;this.clearDirtyFlag();let s=t.row>n.row?n:t,a=t.row>n.row?t:n;a.row>s.row&&a.col===0&&a.row--;for(let o=s.row;o<=a.row;o++)i&&this.lineTypes[o]!==r.commands[e].className&&(this.lines[o]=this.lines[o].replace(r.commands[e].set.pattern,r.commands[e].set.replacement.replace("$#",(o-s.row+1).toString())),this.lineDirty[o]=!0),!i&&this.lineTypes[o]===r.commands[e].className&&(this.lines[o]=this.lines[o].replace(r.commands[e].unset.pattern,r.commands[e].unset.replacement),this.lineDirty[o]=!0);this.updateFormatting(),this.setSelection({row:a.row,col:this.lines[a.row].length},{row:s.row,col:0}),this.fireChange()}}isInlineFormattingAllowed(){const e=window.getSelection();if(!e||!e.focusNode||!e.anchorNode)return!1;if(e.isCollapsed&&e.focusNode.nodeType===3&&e.focusOffset===e.focusNode.nodeValue.length){let t;for(t=e.focusNode;t&&t.nextSibling===null;t=t.parentNode);if(t&&t.nextSibling&&t.nextSibling.className&&t.nextSibling.className.includes("TMInlineFormatted"))return!0}let i=this.computeCommonAncestor(e.focusNode,e.anchorNode);if(!i)return!1;for(;i&&i!==this.e;){if(i.className&&typeof i.className.includes=="function"&&(i.className.includes("TMInlineFormatted")||i.className.includes("TMBlankLine")))return!0;i=i.parentNode}return!1}toggleCommandState(e){this.lastCommandState||(this.lastCommandState=this.getCommandState()),this.setCommandState(e,!this.lastCommandState[e])}fireDrop(e){for(let i of this.listeners.drop)i({dataTransfer:e})}fireSelection(){if(this.listeners.selection&&this.listeners.selection.length){let e=this.getSelection(!1),i=this.getSelection(!0),t=this.getCommandState(e,i);this.lastCommandState?Object.assign(this.lastCommandState,t):this.lastCommandState=Object.assign({},t);for(let n of this.listeners.selection)n({focus:e,anchor:i,commandState:this.lastCommandState})}}}return P.Editor=c,P.default=c,P}var he;function tt(){if(he)return E;he=1;var r=E&&E.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(E,"__esModule",{value:!0}),E.CommandBar=E.Editor=void 0;const c=r(Ye());E.CommandBar=c.default;const m=r(et());return E.Editor=m.default,E}var de=tt(),nt=k('<div class="group"><div class="mb-2"></div> <div></div></div>');function it(r,c){B(c,!0);let m=ee(c,"updateData",3,()=>{}),e,i;Ie(()=>{const a=new de.Editor({element:i,content:c.data.note});new de.CommandBar({element:e,editor:a,commands:["bold","italic","strikethrough","|","code","blockquote","|","h1","h2","|","ul","ol","|","hr"]}),a.addEventListener("change",()=>{let o=a.getContent();m()({...c.data,note:o})})});var t=nt(),n=F(t);le(n,a=>e=a,()=>e);var s=C(n,2);le(s,a=>i=a,()=>i),D(t),v(r,t),I()}var st=(r,c)=>c()(r.target.value),at=k("<option> </option>"),lt=k('<select class="select"><option disabled>Select a quest</option><!></select>'),rt=k('<div class="h-10 w-80 skeleton"></div>');function ot(r,c){B(c,!0);let m=ee(c,"updateQuestId",3,()=>{});var e=W(),i=N(e);Y(i,()=>Me.getInstance().getAll(),t=>{var n=rt();v(t,n)},(t,n)=>{var s=lt();s.__change=[st,m];var a=F(s);a.value=a.__value="";var o=C(a);q(o,17,()=>M(n),u=>u.id,(u,h)=>{var d=at(),l=F(d,!0);D(d);var T={};_(()=>{ae(d,M(h).id===c.questId),R(l,M(h).title),T!==(T=M(h).id)&&(d.value=(d.__value=M(h).id)??"")}),v(u,d)}),D(s),_(()=>ae(a,!c.questId)),v(t,s)}),v(r,e),I()}V(["change"]);var ut=k("<h2> </h2>"),ct=k('<p class="text-error"> </p>'),ht=k('<div class="h-16 w-full skeleton"></div>'),dt=k('<!> <div class="divider divider-horizontal text-xs">OR</div> <button class="btn">New quest</button>',1);function mt(r,c){B(c,!0);async function m(){let s=await Me.getInstance().get(c.data.questId);if(!s)throw new Error("Could not find a quest with this ID!");return s}var e=W(),i=N(e);{var t=s=>{var a=W(),o=N(a);Y(o,m,u=>{var h=ht();v(u,h)},(u,h)=>{var d=ut(),l=F(d,!0);D(d),_(()=>R(l,M(h).title)),v(u,d)},(u,h)=>{var d=ct(),l=F(d);D(d),_(()=>R(l,`Error: ${M(h).message??""}`)),v(u,d)}),v(s,a)},n=s=>{var a=dt(),o=N(a);ot(o,{get questId(){return c.data.questId},updateQuestId:u=>{c.updateData({...c.data,questId:u})}}),Fe(4),v(s,a)};G(i,s=>{c.data.questId?s(t):s(n,!1)})}v(r,e),I()}var pt=k('<div class="absolute -top-2 right-4 flex flex-row"><button class="btn btn-sm">Up</button> <button class="btn btn-sm">Down</button> <button class="btn btn-sm btn-error">Delete block</button></div>'),ft=k('<div class="card relative mb-4 bg-zinc-700 card-sm"><!> <div class="card-body"><!> <!> <!></div></div>');function gt(r,c){B(c,!0);var m=ft(),e=F(m);{var i=d=>{var l=pt(),T=F(l);T.__click=function(...p){c.moveBlockUp?.apply(this,p)};var f=C(T,2);f.__click=function(...p){c.moveBlockDown?.apply(this,p)};var g=C(f,2);g.__click=function(...p){c.deleteBlock?.apply(this,p)},D(l),U(3,l,()=>J,()=>({axis:"x"})),v(d,l)};G(e,d=>{c.showActions&&d(i)})}var t=C(e,2),n=F(t);{var s=d=>{We(d,{get data(){return c.data},get updateData(){return c.updateData},get showActions(){return c.showActions}})};G(n,d=>{c.data.type===w.LIST&&d(s)})}var a=C(n,2);{var o=d=>{it(d,{get data(){return c.data},get updateData(){return c.updateData}})};G(a,d=>{c.data.type===w.NOTE&&d(o)})}var u=C(a,2);{var h=d=>{mt(d,{get data(){return c.data},get updateData(){return c.updateData},get manageMode(){return c.showActions}})};G(u,d=>{c.data.type===w.QUEST&&d(h)})}D(t),D(m),v(r,m),I()}V(["click"]);function Mt(r,c){let m;switch(c){case w.LIST:m={type:w.LIST,title:"New list",hideDone:!1,list:[]};break;case w.NOTE:m={type:w.NOTE,note:"New note"};break;case w.QUEST:m={type:w.QUEST,questId:""};break}return{...r,items:[...r.items,{id:De("item"),data:m}]}}function Tt(r,c){return{...r,items:r.items.filter(m=>m.id!==c)}}function Dt(r,c){const m=r.items.findIndex(e=>e.id===c);if(m>0){const e=[...r.items];return[e[m-1],e[m]]=[e[m],e[m-1]],{...r,items:e}}return r}function vt(r,c){const m=r.items.findIndex(e=>e.id===c);if(m<r.items.length-1){const e=[...r.items];return[e[m+1],e[m]]=[e[m],e[m+1]],{...r,items:e}}return r}function kt(r,c,m){const e=r.items.findIndex(i=>i.id===c);return e!==-1?{...r,items:xe(r.items,e,{...r.items[e],data:m})}:r}async function Ct(r,c,m){await c.delete(M(m).id),Ne("/boards",{state:{message:"Board deleted successfully"},invalidateAll:!0})}var Ft=(r,c,m)=>c({...M(m),title:r.target.value}),bt=k('<div class="flex flex-row justify-center gap-2"><button class="btn btn-outline btn-sm btn-error">Delete board</button> <!></div>'),yt=k("<div><!></div>"),wt=k('<div class="text-center"><input class="input input-xl input-ghost text-center font-bold"/></div> <div class="mb-4 flex flex-row justify-center gap-2"><!></div> <div></div>',1);function Et(r,c){B(c,!0);let m=Z(!1),e=Z(be(c.board));const i=pe.getInstance(),t=async l=>{await i.upsert(He(l));let T=await i.get(l.id);T&&Q(e,T,!0),console.debug("Board updated:",$e(M(e)))},n=Le(t,250);var s=wt(),a=N(s),o=F(a);z(o),o.__input=[Ft,n,e],D(a);var u=C(a,2),h=F(u);Se(h,{get show(){return M(m)},set show(l){Q(m,l,!0)},children:(l,T)=>{var f=bt(),g=F(f);g.__click=[Ct,i,e];var p=C(g,2);qe(p,{createItem:b=>t(Mt(M(e),b))}),D(f),U(3,f,()=>J,()=>({axis:"x",duration:250})),v(l,f)},$$slots:{default:!0}}),D(u);var d=C(u,2);q(d,29,()=>M(e).items,l=>l.id,(l,T)=>{var f=yt(),g=F(f);gt(g,{get data(){return M(T).data},moveBlockUp:()=>t(Dt(M(e),M(T).id)),moveBlockDown:()=>t(vt(M(e),M(T).id)),deleteBlock:()=>t(Tt(M(e),M(T).id)),updateData:p=>t(kt(M(e),M(T).id,p)),get showActions(){return M(m)}}),D(f),fe(f,()=>ge,()=>({duration:300})),U(3,f,()=>Te),v(l,f)}),D(d),_(()=>X(o,M(e).title)),v(r,s),I()}V(["input","click"]);var _t=k('<div class="h-8 w-20 skeleton bg-base-content/30"></div>'),At=k('<div class="mb-4 h-64 w-full skeleton bg-base-content/30"></div>'),xt=k('<div class="mx-auto my-3 h-8 w-60 skeleton bg-base-content/30"></div> <div class="mb-4 flex flex-row justify-center gap-2"></div> <div></div>',1);function Lt(r){var c=xt(),m=C(N(c),2);q(m,4,()=>[1,2,3],i=>i,(i,t)=>{var n=_t();v(i,n)}),D(m);var e=C(m,2);q(e,4,()=>[1,2,3],i=>i,(i,t)=>{var n=At();v(i,n)}),D(e),v(r,c)}var St=k('<p class="text-error"> </p>'),$t=k("<div><!></div>");function Yt(r,c){B(c,!1);async function m(){const t=Ee.url.searchParams.get("id");if(!t)throw new Error("An ID is required !");const n=await pe.getInstance().get(t);if(console.log("Board with ID ",t,n),!n)throw new Error("Could not find a board with this ID !");return n}ke();var e=$t();ye(t=>{we.title="Asgaard - Board"});var i=F(e);Y(i,m,t=>{Lt(t)},(t,n)=>{Et(t,{get board(){return M(n)}})},(t,n)=>{var s=St(),a=F(s);D(s),_(()=>R(a,`Error: ${M(n).message??""}`)),v(t,s)}),D(e),v(r,e),I()}export{Yt as component};
