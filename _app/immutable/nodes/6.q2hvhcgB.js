import"../chunks/DsnmJJEf.js";import{i as et}from"../chunks/B2RB5TeL.js";import{K as at,T as st,b1 as rt,b2 as ot,j as U,p as T,f as m,d as x,r as v,t as Q,i as e,e as j,b,aT as K,c as M,s as h,k as z,n as Z,m as B,l as nt,g as it,h as lt,a as ut,$ as ct}from"../chunks/CdW2wo26.js";import{a as ft}from"../chunks/DvLb1K2C.js";import{f as dt,l as O,Q as $}from"../chunks/BIYFnzYS.js";import{p as vt}from"../chunks/CENNA1TF.js";import{o as bt}from"../chunks/Nbjk0067.js";import{b as _t,u as R,s as H,r as xt,d as mt,A as pt,a as gt}from"../chunks/rM3fkrv5.js";import{e as N,r as L,a as ht,d as G,f as wt}from"../chunks/CQoQAeYi.js";import{s as C,c as E}from"../chunks/DytyakGm.js";import{a as yt,t as D}from"../chunks/BOSBZZph.js";import{p as W,b as qt}from"../chunks/86hmsk0G.js";import{E as J,P as V,b as Ct,c as Et,Q as St}from"../chunks/CTsBqZ3i.js";import{i as kt}from"../chunks/Bbijo58t.js";import{f as Qt,s as P}from"../chunks/DuQvw7Am.js";import{g as It}from"../chunks/BfecHv-i.js";import{g as Dt}from"../chunks/wW2WasLs.js";import{c as At}from"../chunks/BwYyNQVj.js";function Y(r,t,s=!1){if(r.multiple){if(t==null)return;if(!st(t))return rt();for(var l of r.options)l.selected=t.includes(X(l));return}for(l of r.options){var a=X(l);if(ot(a,t)){l.selected=!0;return}}(!s||t!==void 0)&&(r.selectedIndex=-1)}function tt(r){var t=new MutationObserver(()=>{Y(r,r.__value)});t.observe(r,{childList:!0,subtree:!0,attributes:!0,attributeFilter:["value"]}),at(()=>{t.disconnect()})}function X(r){return"__value"in r?r.__value:r.value}var Pt=(r,t)=>t.setEffort(r.target.value),Tt=m("<option> </option>"),Mt=m("<select></select>");function Ot(r,t){T(t,!0);let s=W(t,"class",19,()=>[]),l=K(()=>J[t.effort].colorClass);var a=Mt();a.__change=[Pt,t],N(a,21,()=>Object.entries(J),i=>i[0],(i,c)=>{var u=Tt(),_=x(u,!0);v(u);var f={};Q(()=>{C(u,1,E(e(c)[1].colorClass)),j(_,e(c)[1].text),f!==(f=e(c)[0])&&(u.value=(u.__value=e(c)[0])??"")}),b(i,u)}),v(a);var n;tt(a),Q(()=>{C(a,1,E(["select","select-sm",e(l),s()])),n!==(n=t.effort)&&(a.value=(a.__value=t.effort)??"",Y(a,t.effort))}),b(r,a),M()}U(["change"]);var Rt=(r,t)=>t.setPriority(r.target.value),Lt=m("<option> </option>"),Ut=m("<select></select>");function jt(r,t){T(t,!0);let s=W(t,"class",19,()=>[]),l=K(()=>V[t.priority].colorClass);var a=Ut();a.__change=[Rt,t],N(a,21,()=>Object.entries(V),i=>i[0],(i,c)=>{var u=Lt(),_=x(u,!0);v(u);var f={};Q(()=>{C(u,1,E(e(c)[1].colorClass)),j(_,e(c)[1].text),f!==(f=e(c)[0])&&(u.value=(u.__value=e(c)[0])??"")}),b(i,u)}),v(a);var n;tt(a),Q(()=>{C(a,1,E(["select","select-sm",e(l),s()])),n!==(n=t.priority)&&(a.value=(a.__value=t.priority)??"",Y(a,t.priority))}),b(r,a),M()}U(["change"]);function Ft(r,t,s,l){const a={id:It("subquest"),title:e(t),priority:Et.MEDIUM,effort:Ct.MEDIUM,done:!1};s()([...l.subquests,a])}var zt=m('<div class="flex flex-row gap-1"><!> <!></div>'),Bt=m('<div class="flex flex-row gap-1"><button class="btn btn-outline btn-xs">Up</button> <button class="btn btn-outline btn-xs">Down</button> <button class="btn btn-outline btn-xs btn-error">Delete</button></div>'),Gt=m('<div><input type="checkbox" class="checkbox"/> <input class="input input-sm grow"/> <!></div>'),Kt=m('<div><!> <div><button class="btn btn-square btn-xs btn-info">+</button> <input class="input input-sm grow"/> <div class="flex-1/3"></div> <div class="flex-1/3"></div></div></div>');function Nt(r,t){T(t,!0);let s=W(t,"updateSubquests",3,()=>{}),l=z("");var a=Kt();C(a,1,E(["w-full","px-2","my-2"]));var n=x(a);N(n,27,()=>t.subquests,_=>_.id,(_,f,d)=>{var p=Gt();C(p,1,E(["flex","flex-row","gap-1","items-center",'before:content-["❧"]',"before:text-success","before:mr-2"]));var I=x(p);L(I),I.__change=()=>s()(R(t.subquests,e(d),{...e(f),done:!e(f).done}));var y=h(I,2);L(y),y.__input=w=>s()(R(t.subquests,e(d),{...e(f),title:w.target.value}));var A=h(y,2);{var F=w=>{var o=zt(),g=x(o);jt(g,{get priority(){return e(f).priority},setPriority:k=>s()(R(t.subquests,e(d),{...e(f),priority:k})),class:"flex-1/3"});var q=h(g,2);Ot(q,{get effort(){return e(f).effort},setEffort:k=>s()(R(t.subquests,e(d),{...e(f),effort:k})),class:"flex-1/4"}),v(o),D(1,o,()=>P,()=>({duration:150,axis:"x",easing:O})),D(2,o,()=>P,()=>({duration:250,axis:"x",easing:O})),b(w,o)},S=w=>{var o=Bt(),g=x(o);g.__click=()=>s()(H(t.subquests,e(d),e(d)-1));var q=h(g,2);q.__click=()=>s()(H(t.subquests,e(d),e(d)+1));var k=h(q,2);k.__click=()=>s()(xt(t.subquests,e(d))),v(o),D(1,o,()=>P,()=>({duration:250,axis:"x",easing:O})),D(2,o,()=>P,()=>({duration:150,axis:"x",easing:O})),b(w,o)};kt(A,w=>{t.showActions?w(S,!1):w(F)})}v(p),Q(()=>{ht(I,e(f).done),G(y,e(f).title)}),yt(p,()=>dt,()=>({duration:300})),D(3,p,()=>Qt),b(_,p)});var i=h(n,2);C(i,1,E(["flex","flex-row","gap-1","items-center",'before:content-["❧"]',"before:text-base-content/30","before:mr-2"]));var c=x(i);c.__click=[Ft,l,s,t];var u=h(c,2);L(u),Z(4),v(i),v(a),_t(u,()=>e(l),_=>B(l,_)),b(r,a),M()}U(["change","input","click"]);async function Wt(r,t,s){await t.delete(e(s).id),Dt("/quests",{state:{message:"Quest deleted successfully"},invalidateAll:!0})}var Yt=(r,t,s)=>t({...e(s),title:r.target.value}),Ht=m('<div class="flex flex-row gap-2"><button class="btn btn-outline btn-sm btn-error">Delete quest</button></div>'),Jt=(r,t)=>t(r.target.value),Vt=m('<div><h3> </h3> <input class="input m-2 input-xl input-ghost text-center font-bold"/> <div class="flex flex-row gap-2"><!></div> <span class="mt-2 text-lg font-semibold">&#x2619; Description &#x2767;</span> <textarea class="textarea m-2 w-full resize-none textarea-ghost text-center text-base-content/80"></textarea> <span class="text-lg font-semibold">&#x2619; What you have to do &#x2767;</span> <!> <span class="mt-2">&#x2619; Quest Giver &#x2767;</span></div>');function Xt(r,t){T(t,!0);let s=z(nt(t.quest)),l=z(!1),a,n=K(()=>St[e(s).type]);const i=$.getInstance(),c=new RegExp(/\n/g),u=async o=>{await i.upsert(At(o));let g=await i.get(o.id);g&&B(s,g,!0),console.debug("Quest updated:",gt(e(s)))},_=mt(u,250);function f(o){const g=(o.match(c)||[]).length+1;a.rows=Math.min(g,10),_({...e(s),description:o})}bt(()=>{const o=(e(s).description.match(c)||[]).length+1;a.rows=Math.min(o,10)});var d=Vt(),p=x(d),I=x(p,!0);v(p);var y=h(p,2);L(y),y.__input=[Yt,_,s];var A=h(y,2),F=x(A);pt(F,{get show(){return e(l)},set show(o){B(l,o,!0)},children:(o,g)=>{var q=Ht(),k=x(q);k.__click=[Wt,i,s],v(q),D(3,q,()=>P,()=>({axis:"x",duration:250})),b(o,q)},$$slots:{default:!0}}),v(A);var S=h(A,4);wt(S),S.__input=[Jt,f],qt(S,o=>a=o,()=>a);var w=h(S,4);Nt(w,{get subquests(){return e(s).subquests},updateSubquests:o=>u({...e(s),subquests:o}),get showActions(){return e(l)}}),Z(2),v(d),Q(()=>{C(d,1,E(["border-8","border-double",e(n).borderClass,"rounded-box","flex","flex-col","items-center","p-4","my-6","relative",'before:content-["❦"]',"before:absolute","before:bottom-full","before:left-1/2","before:rotate-180",e(n).beforeClass,"before:text-3xl","before:-translate-x-1/2","before:translate-y-0.5",'after:content-["❦"]',"after:absolute","after:top-full","after:left-1/2",e(n).afterClass,"after:text-3xl","after:-translate-x-1/2","after:-translate-y-0.5"])),C(p,1,E([e(n).colorClass])),j(I,e(n).label),G(y,e(s).title),G(S,e(s).description)}),b(r,d),M()}U(["input","click"]);var Zt=m('<p class="text-error"> </p>'),$t=m('<p class="text-center">Loading quest...</p>');function pe(r,t){T(t,!1);async function s(){const n=vt.url.searchParams.get("id");if(!n)throw new Error("An ID is required !");const i=await $.getInstance().get(n);if(console.log("Quest with ID ",n,i),!i)throw new Error("Could not find a quest with this ID !");return i}et();var l=it();lt(n=>{ct.title="Asgaard - Quest"});var a=ut(l);ft(a,s,n=>{var i=$t();b(n,i)},(n,i)=>{Xt(n,{get quest(){return e(i)}})},(n,i)=>{var c=Zt(),u=x(c);v(c),Q(()=>j(u,`Error: ${e(i).message??""}`)),b(n,c)}),b(r,l),M()}export{pe as component};
